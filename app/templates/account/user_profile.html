{% extends "dashboard.html" %}
{% block title %}
User Profile
{% endblock %}

{% block page_content %}
<div class="font-sans">
	<div class="mx-auto w-64 text-center">
		<img id = "profileImage" class="w-64 h-64 object-cover rounded-full border-2 border-gray-400 hover:border-gray-300 focus:border-gray-300 focus:outline-none" alt="" />
	</div>
</div>

<div class="container mx-auto p-4">
	<div id="errorMessage" class="text-red-500 text-lg mb-4"></div>
	<div id="successMessage" class="text-green-500 text-lg mb-4"></div>

	<div class="grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4">
		<!-- User Profile Information -->
		<div class="min-w-0 rounded-lg overflow-hidden bg-white dark:bg-gray-800">
			<div class="p-4 flex items-center">
				<div class="p-3 rounded-full text-blue-500 dark:text-blue-100 bg-blue-100 dark:bg-blue-500 mr-4">
					<i class = "fas fa-bolt"></i>
				</div>
				<div>
					<p class="mb-2 text-lg font-medium text-gray-600 dark:text-gray-400">
					Active Raffles
					</p>
					<p id="activeRaffles" class="text-lg font-semibold text-gray-700 dark:text-gray-200"></p>
				</div>
			</div>
		</div>

		<div class="min-w-0 rounded-lg overflow-hidden bg-white dark:bg-gray-800">
			<div class="p-4 flex items-center">
				<div class="p-3 rounded-full text-green-500 dark:text-green-100 bg-green-100 dark:bg-green-500 mr-4">
					<i class = "fas fa-hourglass-end"></i>
				</div>
				<div>
					<p class="mb-2 text-lg font-medium text-gray-600 dark:text-gray-400">
					Past Raffles
					</p>
					<p id="pastRaffles" class="text-lg font-semibold text-gray-700 dark:text-gray-200"></p>
				</div>
			</div>
		</div>

		<div class="min-w-0 rounded-lg overflow-hidden bg-white dark:bg-gray-800">
			<div class="p-4 flex items-center">
				<div class="p-3 rounded-full text-red-500 dark:text-red-100 bg-red-100 dark:bg-red-500 mr-4">
					<i class = "fas fa-trophy"></i>
				</div>
				<div>
					<p class="mb-2 text-lg font-medium text-gray-600 dark:text-gray-400">
					Raffles Won
					</p>
					<p id="rafflesWon" class="text-lg font-semibold text-gray-700 dark:text-gray-200"></p>
				</div>
			</div>
		</div>

		<div class="min-w-0 rounded-lg overflow-hidden bg-white dark:bg-gray-800">
			<div class="p-4 flex items-center">
				<div class="p-3 rounded-full text-purple-500 dark:text-purple-100 bg-purple-100 dark:bg-purple-500 mr-4">
					<i class = "fas fa-wallet"></i>
				</div>
				<div>
					<p class="mb-2 text-lg font-medium text-gray-600 dark:text-gray-400">
					Account Balance
					</p>
					<p id="accountBalance" class="text-lg font-semibold text-gray-700 dark:text-gray-200"></p>
				</div>
			</div>
		</div>
	</div>

	<!-- User Profile Details -->
	<div class="bg-white overflow-hidden shadow rounded-lg border">
		<div class="border-t border-gray-200 px-4 py-5 sm:p-0">
			<dl class="sm:divide-y sm:divide-gray-200">
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						User ID
					</dt>
					<dd id="profileUserId" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Full name
					</dt>
					<dd id="profileFullName" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Gender
					</dt>
					<dd id="profileGender" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Email address
					</dt>
					<dd id="profileEmailAddress" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Phone number
					</dt>
					<dd id="profilePhoneNumber" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Nationality
					</dt>
					<dd id="profileNationality" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Is Active
					</dt>
					<dd id="profileIsActive" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Is Confirmed
					</dt>
					<dd id="profileIsConfirmed" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Is Suspended
					</dt>
					<dd id="profileIsSuspended" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Member Since
					</dt>
					<dd id="profileMemberSince" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
				<div class="py-3 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
					<dt class="text-lg font-medium text-gray-500">
						Last Updated
					</dt>
					<dd id="profileLastUpdated" class="mt-1 text-lg text-gray-900 sm:mt-0 sm:col-span-2"></dd>
				</div>
			</dl>
		</div>
	</div>
</div>
<script>
	document.addEventListener('DOMContentLoaded', function () {
			const errorMessage = document.getElementById('errorMessage');
			const successMessage = document.getElementById('successMessage');

			// Fetch user data from the endpoint
			id = {{ user_id }};
			$serverName = "{{ api_server }}";
			fetch(`${serverName}api/administration/users/${id}`, {
					method: 'GET',
					headers: {
							'Content-Type': 'application/json',
						},
				})
				.then(response => {
						if (!response.ok) {
								throw new Error(`HTTP error! Status: ${response.status}`);
							}
						return response.json();
					})
				.then(data => {
						// Populate user profile information
						document.getElementById('activeRaffles').innerText = data.activeRaffles;
						document.getElementById('pastRaffles').innerText = data.pastRaffles;
						document.getElementById('rafflesWon').innerText = data.rafflesWon;
						document.getElementById('accountBalance').innerText = `Ksh ${data.accountBalance.toFixed(2)}`;

						// Populate user profile details
						document.getElementById('profileFullName').innerText = `${data.firstName} ${data.middleName} ${data.lastName}`;
						document.getElementById('profileEmailAddress').innerText = data.emailAddress;
						document.getElementById('profilePhoneNumber').innerText = data.phoneNumber;

						// Additional Fields
						document.getElementById('profileUserId').innerText = data.userId;
						document.getElementById('profileMemberSince').innerText = data.dateCreated;
						document.getElementById('profileLastUpdated').innerText = data.lastUpdated;
						document.getElementById('profileGender').innerText = data.gender;
						document.getElementById('profileNationality').innerText = data.nationality;
						document.getElementById('profileIsActive').innerText = data.isActive ? 'Yes' : 'No';
						document.getElementById('profileIsConfirmed').innerText = data.isConfirmed ? 'Yes' : 'No';
						document.getElementById('profileIsSuspended').innerText = data.isSuspended ? 'Yes' : 'No';


						document.getElementById("profileImage").src = data.imageUrl || data.avatarUrl;

					})
				.catch(error => {
						console.error('Error fetching user data:', error);
						errorMessage.innerText = 'Error fetching user data. Please try again.';
					});
		});
</script>
{% endblock %}
