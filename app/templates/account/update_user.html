{% extends "dashboard.html" %}
{% block title %}
Authors
{% endblock %}

{% block page_content %}
<div id="userUpdateModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
	<div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
		<div class="fixed inset-0 transition-opacity" aria-hidden="true">
			<div class="absolute inset-0 bg-gray-500 opacity-75"></div>
		</div>
		<span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
		<div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
			<div class="bg-gray-200 px-4 py-3 sm:px-6">
				<h3 class="text-lg font-medium leading-6 text-gray-900">Update User</h3>
			</div>
			<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
				<form id="userUpdateForm" class="space-y-4">
					<!-- Input fields for user details -->
					<div>
						<label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
						<input type="text" id="firstName" name="firstName" required
										  class="mt-1 p-2 block w-full border rounded-md shadow-sm focus:outline-none focus:border-blue-500">
					</div>
					<div>
						<label for="middleName" class="block text-sm font-medium text-gray-700">Middle Name</label>
						<input type="text" id="middleName" name="middleName" required
										   class="mt-1 p-2 block w-full border rounded-md shadow-sm focus:outline-none focus:border-blue-500">
					</div>
					<div>
						<label for="lastName" class="block text-sm font-medium text-gray-700">Last Name</label>
						<input type="text" id="lastName" name="lastName" required
										 class="mt-1 p-2 block w-full border rounded-md shadow-sm focus:outline-none focus:border-blue-500">
					</div>
					<!-- Add other input fields here -->

					<!-- Alert messages for success and error -->
					<div id="errorAlert"
					     class="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md hidden">
						<!-- Error messages will appear here -->
					</div>
					<div id="successAlert"
					     class="mt-4 bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded-md hidden">
						<!-- Success messages will appear here -->
					</div>

					<!-- Modal footer -->
					<div class="mt-5 sm:mt-6">
						<button type="submit"
							class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:shadow-outline-blue active:bg-blue-800">
							Update User
						</button>
						<button id="closeUserUpdateModal"
							class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:shadow-outline-gray active:bg-gray-500">
							Cancel
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Fetch API Script -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
			const userUpdateForm = document.getElementById('userUpdateForm');
			const errorAlert = document.getElementById('errorAlert');
			const successAlert = document.getElementById('successAlert');
			const userUpdateModal = document.getElementById('userUpdateModal');
			const openUserUpdateModalBtn = document.getElementById('openUserUpdateModal');
			const closeUserUpdateModalBtn = document.getElementById('closeUserUpdateModal');

			function displayAlert(alertElement, message, isError) {
					alertElement.textContent = message;
					alertElement.classList.remove('hidden');
					alertElement.classList.toggle('bg-red-100', isError);
					alertElement.classList.toggle('bg-green-100', !isError);

					setTimeout(function () {
							alertElement.classList.add('hidden');
						}, 5000); // Hide the alert after 5 seconds
				}

			// Fetch user details (Replace with your actual API endpoint)
			fetch('https://your-api-server.com/api/administration/users/1')
				.then(response => response.json())
				.then(user => {
						// Populate form fields with current user details
						document.getElementById('firstName').value = user.firstName;
						document.getElementById('middleName').value = user.middleName;
						document.getElementById('lastName').value = user.lastName;
						// Populate other form fields similarly
					})
				.catch(error => {
						console.error('Error fetching user details:', error);
						displayAlert(errorAlert, 'Failed to fetch user details. Please try again.', true);
					});

			// Event listener to open the modal
			openUserUpdateModalBtn.addEventListener('click', function () {
					userUpdateModal.classList.remove('hidden');
				});

			// Event listener to close the modal
			closeUserUpdateModalBtn.addEventListener('click', function () {
					userUpdateModal.classList.add('hidden');
				});

			userUpdateForm.addEventListener('submit', function (event) {
					event.preventDefault();

					// Replace the following with your API endpoint for updating user details
					const apiUrl = 'https://your-api-server.com/api/administration/users/1';

					// Extract data from the form
					const formData = new FormData(userUpdateForm);
					const data = {
							firstName: formData.get('firstName'),
							middleName: formData.get('middleName'),
							lastName: formData.get('lastName'),
							// Extract other fields similarly
						};

					// Make a fetch request to update user details
					fetch(apiUrl, {
							method: 'PUT',
							headers: {
									'Content-Type': 'application/json',
								},
							body: JSON.stringify(data),
						})
						.then(response => {
								if (!response.ok) {
										throw new Error(`HTTP error! Status: ${response.status}`);
									}
								return response.json();
							})
						.then(responseData => {
								// Handle successful update
								displayAlert(successAlert, 'User updated successfully', false);
								// You can perform additional actions if needed
							})
						.catch(error => {
								// Handle update errors
								console.error('Error during user update:', error);
								displayAlert(errorAlert, 'User update failed. Please check your information and try again.', true);
							});
				});
		});
</script>
{% endblock %}
